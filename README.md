# TCP-IP

1. 개요

 이 프로그램은 리눅스의 Epoll을 이용한 다중접속 채팅 프로그램임.

2. 목적

 1:1 프로그램의 한계인 메세지를 전송시 다음 메세지를 기다리는 상태를 극복함과 동시에 많은 클라이언트들이 접속하여 메세지를 주고 받기 위함.
 
 차후 Texas holedem의 프로그램과 연계하여 다중 클라이언트 포커게임을 만들기 위함.

3. 개발 및 실행환경

 Linux ubuntu 16.04 LTS
 
 Vim

4. 실행방법

 가) 터미널을 열고 소스파일이 있는 디렉토리로 이동한다.
 
 나) 이 후 터미널에서 g++ epoll_client.cpp -o client 를 입력하고. client 파일이 생성 되었는지 확인한다.
 
 다) 이 후 터미널에서 g++ epoll_server.cpp -o server 를 입력하고. server 파일이 생성 되었는지 확인한다.
 
    주의: g++로 컴파일이 안될 시에 g++을 설치할 것.우분투는 기본적으로 g++이 설치되어 있지 않음
    
 라) ./server 를 입력.
 
 마) 또다른 터미널을 열고 컴파일이 된 디렉토리로 이동을 한뒤 ./client 127.0.0.1 3600 을 실행.
 

5. 제한사항

 가) 접속을 끊으면 epollfd에 삭제되는 코드를 제대로 구현안함.
 
 나) 클라이언트부분의 경우 메세지를 받을때 버퍼가 안비워지는 것에 대해 감안하였음. 
 

6. 상세설명

 설명하기 앞서 이 프로그램은 [banu.com](https://banu.com/blog/2/how-to-use-epoll-a-complete-example-in-c/epoll-example.c) 사이트의 epoll 예제를 참고하여 만든 것이다.
 
 이 프로그램은 동기/비봉쇄 모델을 가지는 Epoll을 사용하였고, 장점으로는 멀티프로세스처럼 IPC를 구현 할 필요없고 멀티스레드처럼 코딩할 시 발생하는
 가독성 문제를 해결해주는 것이고 select함수의 비효율성을 극복하는 장점을 가지고 있다.
 
 Epoll은 FreeBSD의 kqueue(Mac OS),Window의 IOCP(Window)와 똑같은 함수이다.
 
 먼저 풀(epoll_create1)을 만들고 listen 대기열로 들어왔다는 정보를 먼저 풀(epollfd)에 추가(epoll_ctl)를 하고,루프문을 통해 풀로 들어온
 
 정보를 체크하면서 새로 접속한 클라이언트에 대해서는 풀 추가(EPOLL_CTL_ADD)를 하고 기존 클라이언트의 정보가 바뀐 것을 확인 했을때는 read를 통해
 성공시 메세지를 읽고 그것을 다시 epollfd에 있는 접속 된 클라이언트들에 다시 write해서 보낸다.
 
 여기서 banu.com 소스부분과 다른 점은 클라이언트가 접속 시에 이름을 묻고 다시 그 정보를 받아와서 epoll_ctl을 통해 수정을 한다는 점.
 
7. 문제점

 가) 클라이언트 부분의 경우 메세지 작성 도중 다른 클라이언트의 메세지를 받을때 쓰던 메세지가 지워져서 다시 작성해야함.
 
 나) 주석이 없음.
 
 다) 코드가 더러움.
 

8. 향후 방향

 가) 이 epoll을 발전시켜서 Texas holedem에 접목하여 다중접속 클라이언트 포커게임을 만들기 위함.

9. 참조
 
 

 
